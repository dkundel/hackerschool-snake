<!doctype html>
<html>
<head>
  <title>My Awesome Snake</title>
  <link href="//fonts.googleapis.com/css?family=Press+Start+2P" rel="stylesheet" type="text/css">
  <style>
    html {
      background: black;
      color: limegreen;
      font-family: 'Press Start 2P', cursive;
    }

    html, body {
      width: 100%;
      text-align: center
    }

    body {
      margin: 0;
    }

    h1,h2,h3,h4,h5,h6,h7 {
      font-weight: normal;
    }
    .hidden {
      display: none;
    }
    button {
      border: 4px limegreen solid;
      padding: 10px;
      background: black;
      color: limegreen;
      font-family: 'Press Start 2P', cursive;
    }

    button:hover, button:active, button:focus {
      background: #333333;
    }

  </style>
</head>
<body>
  <h1>Snake</h1>
  <div id="preGameDialog">
    <button id="startGameButton">Neues Spiel</button>
  </div>
  <div id="gameDialog" class="hidden">
    <h2 id="gameOver" class="hidden">Game Over!</h2>
    <h3>Deine Punkte: <span id="yourScore"></span></h3>
    <canvas id="canvas" width="450" height="450"></canvas>
  </div>
</body>
<script>
</script>
<script>
  var canvas = document.getElementById('canvas');
  var ctx = canvas.getContext('2d');
  var w = canvas.width;
  var h = canvas.height;
  var cw = 10;
  var d;
  var food;
  var score;
  var snake_array;
  var game_loop;

  function hideSection (id) {
  	document.getElementById(id).className += 'hidden';
  }

  function showSection (id) {
   	document.getElementById(id).className = document.getElementById(id).className.replace(/\s?hidden\s?/g, '');
  }

  function onStartGame (evt) {
    hideSection('preGameDialog');
    showSection('gameDialog');
    init();
  }

  function init () {
    d = 'right';
    createSnake();
    createFood();
    score = 0;
    if (typeof game_loop !== 'undefined') {
      clearInterval(game_loop);
    }
    game_loop = setInterval(loop, 80);
  }

  function endGame () {
    if (typeof game_loop !== 'undefined') {
      clearInterval(game_loop);
    }
	showSection('gameOver');
    showSection('preGameDialog');
  }

  function createSnake () {
    var length = 5;
    snake_array = [];
    opponent_snake = [];
    for (var i = length-1; i >= 0; i--) {
      snake_array.push({x: i, y: 0});
    }
  }

  function createFood () {
    food = {
      x: Math.round(Math.random()*(w-cw)/cw),
      y: Math.round(Math.random()*(h-cw)/cw)
    }
  }

  function loop () {
  	var nx = snake_array[0].x;
    var ny = snake_array[0].y;

    if (d === 'right') {
      nx++;
    } else if (d === 'left') {
      nx--;
    } else if (d === 'up') {
      ny--;
    } else if (d === 'down') {
      ny++;
    }

    if (nx === -1 || nx === w/cw || ny === -1 || ny === h/cw || checkCollision(nx, ny, snake_array)) {
	  endGame();
      return;
    }

    if (nx === food.x && ny === food.y) {
      var tail = {x: nx, y: ny};
      score++;
      createFood();
    } else {
      var tail = snake_array.pop();
      tail.x = nx;
      tail.y = ny;
    }

    snake_array.unshift(tail);

    paint();
  }

  function paint () {
    ctx.fillStyle = '#333333';
    ctx.fillRect(0, 0, w, h);
    ctx.strokeStyle = 'limegreen';
    ctx.strokeRect(0, 0, w, h);

    for (var i = 0; i < snake_array.length; i++) {
      var c = snake_array[i];
      paintCell(c.x, c.y, 'limegreen');
    }

    paintCell(food.x, food.y, 'red');

  	document.getElementById('yourScore').innerHTML = score;
  }

  function paintCell (x,y, color) {
    ctx.fillStyle = color;
    ctx.fillRect(x*cw, y*cw, cw, cw);
    ctx.strokeStyle = '#333333';
    ctx.strokeRect(x*cw, y*cw, cw, cw);
  }

  function checkCollision (x, y, array) {
    for (var i = 0; i < array.length; i++) {
      if (array[i].x === x && array[i].y === y) {
        return true;
      }
    }
    return false;
  }

  function handleKeyPress (evt) {
    var key = evt.which;
    if (key == '37' && d != 'right') d = 'left';
    else if (key == '38' && d != 'down') d = 'up';
    else if (key == '39' && d != 'left') d = 'right';
    else if (key == '40' && d != 'up') d = 'down';
  }

  document.getElementById('startGameButton').addEventListener('click', onStartGame, false);
  window.addEventListener('keydown', handleKeyPress, false);

</script>
</html>
